extends layout
block header
  nav.nav
    .site-identity
      a(href="/")
        img(src="/images/logos.png" alt="Site logo")
    .nav__buttons
      a.button(href='#')
        !=h.icon('user-solid') 
        span=user.userName
      a.button(href=`/history/tasks/${user.userName}/${user._id}`)
        !=h.icon('history-solid')
        span History
      a.button(href='/logout')
        !=h.icon('sign-out')
        span Logout

include mixins/_pagination

block content
  .left
    center
      h3 TODAY
    .pendings
      h3.untreatedToday= untreatedToday.length
      hr
      h4 UNTREATED
      //- h6 TODAY
    .treated
      h3= treatedTasks.length
      hr
      h4 TREATED
      //- h6 TODAY
  .task
    //- .treated
    //-   h3= treatedTasks.length
    //-   h4 TREATED
    //- .pendings
    //-   h3= pendingTasks.length
    //-   h4 PENDINGS

    #live
      table.task__queue--table(data-id=user._id)
        thead
          tr
            th REGISTRATION NO
            th BUSINESS NAME
            th STATE
            th DATE
            th STATUS
            th ACTION
            //- th DATE REGISTERED
        //- tbody(id="table")
        tbody.pendingsTasks(id="table" data-id=`${user.id}`)
          each business in businesses
            -const status = business.isTreated == false ? 'Untreated' : 'Treated'
            -const color = status == 'Treated' ? 'green' : 'brown'
            tr
              td=business.regNumber
              td=business.businessName
              td=business.state
              td=`${business.dateOfReg.getFullYear()}-${business.dateOfReg.getMonth()}-${business.dateOfReg.getDate()}`
              td(style=`font-size:12px;color:${color};`)=status
              td
                a.button(href=`/business/${business.slug}/${business._id}` style='color:white;background-color: #1c330d; padding: 4px;') VIEW

        tbody.totalTasks(id="myTable" style='display: none')
          each business in total
            -const status = business.isTreated == false ? 'Untreated' : 'Treated'
            -const color = status == 'Treated' ? 'green' : 'brown'
            tr
              td=business.regNumber
              td=business.businessName
              td=business.state
              td=`${business.dateOfReg.getFullYear()}-${business.dateOfReg.getMonth()}-${business.dateOfReg.getDate()}`
              td(style=`font-size:12px;color:${color};`)=status
              td
                a.button(href=`/business/${business.slug}/${business._id}` style='color:white;background-color: #1c330d; padding: 4px;') VIEW
          
        tbody.treatedTasks(id="myTable" style='display: none')
          each business in treatedTasks
            -const status = business.isTreated == false ? 'Untreated' : 'Treated'
            -const color = status == 'Treated' ? 'green' : 'brown'
            tr
              td=business.regNumber
              td=business.businessName
              td=business.state
              td=`${business.dateOfReg.getFullYear()}-${business.dateOfReg.getMonth()}-${business.dateOfReg.getDate()}`
              td(style=`font-size:12px;color:${color};`)=status
              td
                a.button(href=`/business/${business.slug}/${business._id}` style='color:white;background-color: #1c330d; padding: 4px;') VIEW

      script(src="/socket.io/socket.io.js")

  .right
    center
      h3 TOTAL
    .total__received
      h3.totalReceived= total.length
      hr
      h4 RECEIVED
    .total__pendings
      h3.totalUntreated= pendingTasks.length
      hr
      h4 UNTREATED
    //- .total__pendings
    //-   h3= pendingTasks.length
    //-   h4 TOTAL PENDINGS